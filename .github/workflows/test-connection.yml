name: Test Huawei Cloud Connection

on:
  workflow_dispatch:  # Just manual execution

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Configure Huawei Cloud
        uses: huaweicloud/auth-action@v1.0.0
        with:
          access_key_id: ${{ secrets.OBS_AK }}
          secret_access_key: ${{ secrets.OBS_SK }}
          region: ${{ secrets.HWC_REGION }}

      - name: Install obsutil
        run: |
          wget https://obs-community.obs.cn-north-1.myhuaweicloud.com/obsutil/current/obsutil_linux_amd64.tar.gz
          tar -xzf obsutil_linux_amd64.tar.gz
          ./obsutil_linux_amd64/obsutil version

      - name: Test connection
        run: |
          # Configurar obsutil
          ./obsutil_linux_amd64/obsutil config -i=${{ secrets.OBS_AK }} -k=${{ secrets.OBS_SK }} -e=${{ secrets.OBS_ENDPOINT }}
          
          # Probar listado de buckets
          echo "üì¶ Listando buckets..."
          ./obsutil_linux_amd64/obsutil ls
          
          # Probar bucket espec√≠fico
          echo "üìÅ Contenido del bucket..."
          ./obsutil_linux_amd64/obsutil ls obs://${{ secrets.OBS_BUCKET }}/
          
          echo "‚úÖ Conexi√≥n exitosa con Huawei Cloud!"